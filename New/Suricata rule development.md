

![Pasted image 20241009195326](https://github.com/user-attachments/assets/cbc68079-3124-4b23-bc77-329d3e07b1e5)



Suricata Key Features

Key features that bolster Suricata's effectiveness include:

    Deep packet inspection and packet capture logging
    Anomaly detection and Network Security Monitoring
    Intrusion Detection and Prevention, with a hybrid mode available
    Lua scripting
    Geographic IP identification (GeoIP)
    Full IPv4 and IPv6 support
    IP reputation
    File extraction
    Advanced protocol inspection
    Multitenancy



# Ubuntu from Personal Package Archives (PPA)

Binary packages:


```
sudo apt-get install software-properties-common
sudo add-apt-repository ppa:oisf/suricata-stable
sudo apt-get update



Then, you can install the latest stable with:

sudo apt-get install suricata


```


# Upgrading:

```
To upgrade:

sudo apt-get update
sudo apt-get upgrade suricata



```
# Remove:
```
To remove Suricata from your system:

sudo apt-get remove suricata
```



### Updating Suricata default set rules:



![Pasted image 20241008150324](https://github.com/user-attachments/assets/0287d822-8321-4525-8698-ed060c031355)



### Configuring Suricata:


a) Enabling PCAP log
b) Disabling suricata.rules and  adding the local.rule  "custom"path 
c) Adding the network range to the HOME_NET variable:



![Pasted image 20241008163021](https://github.com/user-attachments/assets/0683f298-fe4c-430e-80ce-c3aab989ca21)



### Offline input reading PCAP files:

```
suricata -r /home/lm3nitro/pcaps/lm3nitro.evil.pcap
```

An alternative command can be executed to bypass checksums (-k flag) and log in a different directory (-l flag).


```
suricata -r /home/lm3nitro/pcaps/lm3nitro.evil.pcap -k -l .

```

For live input, we can try Suricataâ€™s (Live) LibPCAP mode as follows.

```
sudo suricata --pcap=ens160 -vv
```




###  Suricata rule to detect NMAP Ping sweep:

```
alert icmp any any <> any  any (msg:"Potential ICMP Ping Sweep detected"; itype:8; threshold: type both, track by_src, count 5, seconds 10; sid:1000003; rev:1;)

```

### Ping sweep with Nmap:

nmap -sn 192.168.1.0/24


![Pasted image 20241008160247](https://github.com/user-attachments/assets/f66ad021-2d7e-4922-ba8e-6c208a7617fc)

### Capuring the traffic with TCPdump:


![Pasted image 20241008160458](https://github.com/user-attachments/assets/1c2d0b75-9cb7-4637-b85d-23fe77337942)


### Reading the pcap with Suricata:


![Pasted image 20241008160350](https://github.com/user-attachments/assets/895e0ae2-9300-482f-89eb-70b9281ec675)

## Listing the log files:


![Pasted image 20241008161553](https://github.com/user-attachments/assets/5a10c42e-0ce4-4dca-b5a2-0d7d5978570e)


### Suricata fast.log "alert logs":


![Pasted image 20241008160146](https://github.com/user-attachments/assets/b9d13a0c-4301-4617-82bd-fa0359a21257)

### Analysing the pcap file:



![Pasted image 20241008162132](https://github.com/user-attachments/assets/a5864486-7054-402f-8b82-c4ff8e522306)



### Detecting TCP SYN  Scans:

```
alert tcp any any -> any any (msg:"Nmap TCP SYN Scan detected"; flags:S; threshold: type both, track by_src, count 10, seconds 1; sid:1000002; rev:1;)

alert tcp any any -> any any (msg:"Nmap half-open SCAN)"; flow:to_server,stateless; flags:S; window:1024; tcp.mss:1460; threshold:type threshold, track by_src, count 20, seconds 70; sid:10000001; priority:1; rev:1;)
```


SYN San with Nmap:

nmap -sS 10.10.100.1


![Pasted image 20241008164019](https://github.com/user-attachments/assets/336f5c55-01af-4afc-a127-f5dc2c6f3f55)



Capuring the traffic with TCPdump:


![Pasted image 20241008164212](https://github.com/user-attachments/assets/d6274292-9d14-47de-bd57-8f7721f25697)



Reading the pcap with Suricata:





Suricata fast.log "alert logs":

Listing the files and analysing the Suricata alerts generated by the Nmap scanner.


20241008164441###################

Analysing the pcap file:

![[Attachments/Pasted image 20241008164938.png]]

###  Screenshot of the custom rules :
 
 File path: /home/lm3nitro/Desktop/local.rules

![[Attachments/Pasted image 20241009194605.png]]


### Detecting ACK scans:

```
alert tcp any any -> any any (msg:"Nmap TCP ACK Scan detected"; flags:A; threshold: type both, track by_src, count 10, seconds 1; sid:1000002; rev:1;)
```

ACK San with Nmap:

![[Attachments/Pasted image 20241009171651.png]]

Capuring the traffic with TCPdump:

![[Attachments/Pasted image 20241009171910.png]]
Reading the pcap with Suricata:

![[Attachments/Pasted image 20241009171837.png]]
Suricata fast.log "alert logs":

![[Attachments/Pasted image 20241009171801.png]]


Analysing the pcap file:

![[Attachments/Pasted image 20241009172156.png]]



### Detecting RST scans:

Custom Scan Types with --scanflags: 

The --scanflags argument can be a numerical flag value such as 9 (PSH and FIN), but using symbolic names is easier. Just mash together any combination of URG, ACK, PSH, RST, SYN, and FIN. For example, --scanflags URGACKPSHRSTSYNFIN sets everything, though it's not very useful for scanning. The order these are specified in is irrelevant.

In addition to specifying the desired flags, you can specify a TCP scan type (such as -sA or -sF). That base type tells Nmap how to interpret responses. For example, a SYN scan considers no-response indicative of a filtered port, while a FIN scan treats the same as open|filtered. Nmap will behave the same way it does for the base scan type, except that it will use the TCP flags you specify instead. If you don't specify a base type, SYN scan is used.

In addition to specifying the desired flags, you can specify a TCP scan type (such as -sA or -sF). That base type tells Nmap how to interpret responses. For example, a SYN scan considers no-response indicative of a filtered port, while a FIN scan treats the same as open|filtered. Nmap will behave the same way it does for the base scan type, except that it will use the TCP flags you specify instead. If you don't specify a base type, SYN scan is used.

```
alert tcp any any -> any any (msg:"Nmap TCP RST Scan detected"; flags:R; threshold: type both, track by_src, count 5, seconds 1; sid:1000003; rev:1;)
```


Suricata fast.log "alert logs":

![[Attachments/Pasted image 20241009173529.png]]


Analysing the pcap file:

![[Attachments/Pasted image 20241009173856.png]]


### Detecting FIN scans

```
alert tcp any any -> any 1:1024 (msg:"Nmap TCP FIN Scan detected"; flags:F; threshold: type both, track by_src, count 5, seconds 1; sid:1000002; rev:2;)
```
Suricata fast.log "alert logs":

![[Attachments/Pasted image 20241009174738.png]]


Analysing the pcap file:
![[Attachments/Pasted image 20241009175808.png]]


#### Using jq to filter alerts:

jq 'select(.alert )' eve.json | head -20

![[Attachments/Pasted image 20241009194146.png]]


### Detecting Fragmentation scans:


```
alert ip any any -> any any (msg:"Nmap FRAG Scan detected)"; fragbits:M+D; threshold:type limit, track by_src, count 3, seconds 1210; sid:10000004; rev:1;)
```
Suricata fast.log "alert logs":
![[Attachments/Pasted image 20241009180200.png]]



![[Attachments/Pasted image 20241009180116.png]]

Analysing the pcap file:
![[Attachments/Pasted image 20241009175649.png]]



### Detecting Smax scans:

```
alert tcp any any -> any any (msg:"Nmap SMAX Scan detected)"; flags:FPU; flow:to_server,stateless; threshold:type threshold, track by_src, count 3, seconds 120;  sid:10000001; rev:1;)
```



![[Attachments/Pasted image 20241009181625.png]]
Suricata fast.log "alert logs":

![[Attachments/Pasted image 20241009181045.png]]

Analysing the pcap file:
![[Attachments/Pasted image 20241009181125.png]]


### Detecting  -sT Connect scans

```

alert tcp any any -> any any (msg:"SYN-ACK 3-WAY SCAN)"; flow:to_server; window:64240; flags:S; threshold:type threshold, track by_src, count 20, seconds 70;  sid:10000001; rev:1;)
```

Suricata fast.log "alert logs":
![[Attachments/Pasted image 20241009182423.png]]

Analysing the pcap file:

![[Attachments/Pasted image 20241009182644.png]]



