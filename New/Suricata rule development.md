

![Pasted image 20241009195326](https://github.com/user-attachments/assets/cbc68079-3124-4b23-bc77-329d3e07b1e5)



Suricata Key Features

Key features that bolster Suricata's effectiveness include:

    Deep packet inspection and packet capture logging
    Anomaly detection and Network Security Monitoring
    Intrusion Detection and Prevention, with a hybrid mode available
    Lua scripting
    Geographic IP identification (GeoIP)
    Full IPv4 and IPv6 support
    IP reputation
    File extraction
    Advanced protocol inspection
    Multitenancy



# Ubuntu from Personal Package Archives (PPA)

Binary packages:


```
sudo apt-get install software-properties-common
sudo add-apt-repository ppa:oisf/suricata-stable
sudo apt-get update



Then, you can install the latest stable with:

sudo apt-get install suricata


```


# Upgrading:

```
To upgrade:

sudo apt-get update
sudo apt-get upgrade suricata



```
# Remove:
```
To remove Suricata from your system:

sudo apt-get remove suricata
```



### Updating Suricata default set rules:



![Pasted image 20241008150324](https://github.com/user-attachments/assets/0287d822-8321-4525-8698-ed060c031355)



### Configuring Suricata:


a) Enabling PCAP log
b) Disabling suricata.rules and  adding the local.rule  "custom"path 
c) Adding the network range to the HOME_NET variable:



![Pasted image 20241008163021](https://github.com/user-attachments/assets/0683f298-fe4c-430e-80ce-c3aab989ca21)



### Offline input reading PCAP files:

```
suricata -r /home/lm3nitro/pcaps/lm3nitro.evil.pcap
```

An alternative command can be executed to bypass checksums (-k flag) and log in a different directory (-l flag).


```
suricata -r /home/lm3nitro/pcaps/lm3nitro.evil.pcap -k -l .

```

For live input, we can try Suricataâ€™s (Live) LibPCAP mode as follows.

```
sudo suricata --pcap=ens160 -vv
```




###  Suricata rule to detect NMAP Ping sweep:

```
alert icmp any any <> any  any (msg:"Potential ICMP Ping Sweep detected"; itype:8; threshold: type both, track by_src, count 5, seconds 10; sid:1000003; rev:1;)

```

### Ping sweep with Nmap:

nmap -sn 192.168.1.0/24


![Pasted image 20241008160247](https://github.com/user-attachments/assets/f66ad021-2d7e-4922-ba8e-6c208a7617fc)

### Capuring the traffic with TCPdump:


![Pasted image 20241008160458](https://github.com/user-attachments/assets/1c2d0b75-9cb7-4637-b85d-23fe77337942)


### Reading the pcap with Suricata:


![Pasted image 20241008160350](https://github.com/user-attachments/assets/895e0ae2-9300-482f-89eb-70b9281ec675)

## Listing the log files:


![Pasted image 20241008161553](https://github.com/user-attachments/assets/5a10c42e-0ce4-4dca-b5a2-0d7d5978570e)


### Suricata fast.log "alert logs":


![Pasted image 20241008160146](https://github.com/user-attachments/assets/b9d13a0c-4301-4617-82bd-fa0359a21257)

### Analysing the pcap file:



![Pasted image 20241008162132](https://github.com/user-attachments/assets/a5864486-7054-402f-8b82-c4ff8e522306)



### Detecting TCP SYN  Scans:

```
alert tcp any any -> any any (msg:"Nmap TCP SYN Scan detected"; flags:S; threshold: type both, track by_src, count 10, seconds 1; sid:1000002; rev:1;)

alert tcp any any -> any any (msg:"Nmap half-open SCAN)"; flow:to_server,stateless; flags:S; window:1024; tcp.mss:1460; threshold:type threshold, track by_src, count 20, seconds 70; sid:10000001; priority:1; rev:1;)
```


SYN San with Nmap:

nmap -sS 10.10.100.1


![Pasted image 20241008164019](https://github.com/user-attachments/assets/336f5c55-01af-4afc-a127-f5dc2c6f3f55)



Capuring the traffic with TCPdump:


![Pasted image 20241008164212](https://github.com/user-attachments/assets/d6274292-9d14-47de-bd57-8f7721f25697)



Reading the pcap with Suricata:



![Pasted image 20241008164502](https://github.com/user-attachments/assets/e55078f2-8a1c-4646-a040-ce0285eefabb)



Suricata fast.log "alert logs":

Listing the files and analysing the Suricata alerts generated by the Nmap scanner.

![Pasted image 20241008164441](https://github.com/user-attachments/assets/c3ad9aa1-68a6-4bcb-a654-200d85380138)


Analysing the pcap file:

![Pasted image 20241008164938](https://github.com/user-attachments/assets/dbed3347-315b-4292-8daf-9ebff6b843c2)


###  Screenshot of the custom rules :
 
 File path: /home/lm3nitro/Desktop/local.rules

![Pasted image 20241009194605](https://github.com/user-attachments/assets/3c39afeb-fb8b-48a0-a5d6-7f775ed9d019)



### Detecting ACK scans:

```
alert tcp any any -> any any (msg:"Nmap TCP ACK Scan detected"; flags:A; threshold: type both, track by_src, count 10, seconds 1; sid:1000002; rev:1;)
```

ACK San with Nmap:

![Pasted image 20241009171651](https://github.com/user-attachments/assets/530501f8-a609-400a-8aae-bb4195671875)


Capuring the traffic with TCPdump:
![Pasted image 20241009171910](https://github.com/user-attachments/assets/2a49ba3d-c88f-4011-8e30-7b3722645e52)

Reading the pcap with Suricata:

![Pasted image 20241009171837](https://github.com/user-attachments/assets/06160e4b-0bfc-4f3c-bd10-99f69e76063c)

Suricata fast.log "alert logs":



![Pasted image 20241009171801](https://github.com/user-attachments/assets/364dad6a-226f-4704-ba09-409d2bf240b9)


Analysing the pcap file:


![Pasted image 20241009172156](https://github.com/user-attachments/assets/94367d83-681a-4377-97f9-644b695bdd4b)




### Detecting RST scans:

Custom Scan Types with --scanflags: 

The --scanflags argument can be a numerical flag value such as 9 (PSH and FIN), but using symbolic names is easier. Just mash together any combination of URG, ACK, PSH, RST, SYN, and FIN. For example, --scanflags URGACKPSHRSTSYNFIN sets everything, though it's not very useful for scanning. The order these are specified in is irrelevant.

In addition to specifying the desired flags, you can specify a TCP scan type (such as -sA or -sF). That base type tells Nmap how to interpret responses. For example, a SYN scan considers no-response indicative of a filtered port, while a FIN scan treats the same as open|filtered. Nmap will behave the same way it does for the base scan type, except that it will use the TCP flags you specify instead. If you don't specify a base type, SYN scan is used.

In addition to specifying the desired flags, you can specify a TCP scan type (such as -sA or -sF). That base type tells Nmap how to interpret responses. For example, a SYN scan considers no-response indicative of a filtered port, while a FIN scan treats the same as open|filtered. Nmap will behave the same way it does for the base scan type, except that it will use the TCP flags you specify instead. If you don't specify a base type, SYN scan is used.

```
alert tcp any any -> any any (msg:"Nmap TCP RST Scan detected"; flags:R; threshold: type both, track by_src, count 5, seconds 1; sid:1000003; rev:1;)
```


Suricata fast.log "alert logs":


![Pasted image 20241009173529](https://github.com/user-attachments/assets/21cd873b-23dd-4ef2-92bb-311edbab7474)



Analysing the pcap file:



![Pasted image 20241009173856](https://github.com/user-attachments/assets/c0e8946d-3209-4e24-9cfe-84e878408afc)


### Detecting FIN scans

```
alert tcp any any -> any 1:1024 (msg:"Nmap TCP FIN Scan detected"; flags:F; threshold: type both, track by_src, count 5, seconds 1; sid:1000002; rev:2;)
```
Suricata fast.log "alert logs":


![Pasted image 20241009174738](https://github.com/user-attachments/assets/8c2695e1-1cd2-485a-8c31-1bc2660693ec)


Analysing the pcap file:

![Pasted image 20241009175808](https://github.com/user-attachments/assets/33ecbd52-3d99-4aaf-8fb2-8343d225b17a)



#### Using jq to filter alerts:

jq 'select(.alert )' eve.json | head -20


![Pasted image 20241009194146](https://github.com/user-attachments/assets/3da64699-160d-4104-8601-931c356ee794)


### Detecting Fragmentation scans:


```
alert ip any any -> any any (msg:"Nmap FRAG Scan detected)"; fragbits:M+D; threshold:type limit, track by_src, count 3, seconds 1210; sid:10000004; rev:1;)
```
Suricata fast.log "alert logs":

![Pasted image 20241009180200](https://github.com/user-attachments/assets/5b25864c-d933-4cca-b0a2-3f5e6aa573eb)





![Pasted image 20241009180116](https://github.com/user-attachments/assets/57149621-1464-4082-8141-d2c49b3791fa)


Analysing the pcap file:

![Pasted image 20241009175649](https://github.com/user-attachments/assets/9cadef88-76ae-4752-bec8-ccd76fd4b455)




### Detecting Smax scans:

```
alert tcp any any -> any any (msg:"Nmap SMAX Scan detected)"; flags:FPU; flow:to_server,stateless; threshold:type threshold, track by_src, count 3, seconds 120;  sid:10000001; rev:1;)
```




![Pasted image 20241009181625](https://github.com/user-attachments/assets/c5aa2ed6-2c69-43f7-9368-112f0c454509)

Suricata fast.log "alert logs":


![Pasted image 20241009181045](https://github.com/user-attachments/assets/a09a2e9e-8799-486b-866a-5a558e68b387)


Analysing the pcap file:

![Pasted image 20241009181125](https://github.com/user-attachments/assets/10448e30-9b47-445e-9473-0e64bdcf0754)



### Detecting  -sT Connect scans

```

alert tcp any any -> any any (msg:"SYN-ACK 3-WAY SCAN)"; flow:to_server; window:64240; flags:S; threshold:type threshold, track by_src, count 20, seconds 70;  sid:10000001; rev:1;)
```

Suricata fast.log "alert logs":

![Pasted image 20241009182423](https://github.com/user-attachments/assets/a87479f9-897d-49f7-a4df-c512146dda82)


Analysing the pcap file:


![Pasted image 20241009182644](https://github.com/user-attachments/assets/f6f09cde-bfb0-4080-b73a-743aa02a2489)



