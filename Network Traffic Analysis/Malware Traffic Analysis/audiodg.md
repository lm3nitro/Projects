# Introduction

A user in the corporate network has downloaded and executed a suspicious executable file, but no DNS query was logged for the download. This suggests that the executable may have been retrieved using an IP address directly, bypassing traditional domain name resolution (DNS). The PCAP (Packet Capture) file for the event has been provided for analysis.

## Report Information:

To get started, I used capinfos to get information on the pcap. Capinfos provides all available statistics of the file provided.

```
capinfos 2021-09-14.pcap
```

![Pasted image 20250104105229](https://github.com/user-attachments/assets/23439029-7661-4007-9771-ec7521bcbe38)

Amount of packets in the pcap:

```
tcpdump -nr 2021-09-14.pcap --count
```

Amount of packets on port 80:

```
tcpdump -tt -nr 2021-09-14.pcap 'host 10.0.0.168 and port 80' --count
```

**Date of Analysis:** 09-14-2021
**PCAP File Name:** 2021-09-14.pcap
**PCAP File Size:** 2450 KB
**PCAP Duration:** 584.90457 seconds
**Source of PCAP:** Intrusion Detection System (IDS)

![Pasted image 20250104111557](https://github.com/user-attachments/assets/876b2059-0fc0-4eea-b336-7bc2709215dc)

## Summary of Findings

The analysis of the provided PCAP file revealed potential malicious traffic where there was a malicious executable that was downloaded via port 80. 

## Filtering PCAP

In this scenario, the IP of the affected endpoint was 10.0.0.168. Next, I filtered for the GET and POST requests coming from this endpoint:

```
tcpdump -tt -nr 2021-09-14.pcap 'host 10.0.0.168 and host 103.232.55.148' | grep -E "GET|POST"
```

![Pasted image 20250104111501](https://github.com/user-attachments/assets/b5d07711-2841-4e30-9ef4-4d225e37cfc3)

Based on the output from the screenshot above, I see that there was an executable that was downloaded from the IP 103.232.55.148.

## Decoding Payload

Now that I identified the name of the executable that was downloaded, I used tcpdump to filter the traffic containing this executable:

```
tcpdump -tt -nr 2021-09-14.pcap  -A | grep "audiodg.exe" -A 500 | less
```

![Pasted image 20250104112723](https://github.com/user-attachments/assets/31793075-e6fc-4b28-9311-80ca38ec2709)

The information returned allowed me to see the URL that was used to download the executable.

The output below also provided more information about the server and the payload:

![Pasted image 20250104114436](https://github.com/user-attachments/assets/7aa37cf8-394b-42c3-82cf-fce0160c255b)

Based on the information gathered, the attacker is using the bing.com API to query/redirect to the server where the EXE file is hosted. 

![Pasted image 20250104113233](https://github.com/user-attachments/assets/f68c3659-4046-4628-8e21-2c0e58facffe)

The IP that I see in the traffic above shows the IP 13.107.5.80. This IP is associated with Microsoft/Bing. It appears that the user navigated to this IP and was then redirected to the IP mentioned above (103.323.55.148), where the executable was downloaded from. Below is the information on the bing IP:

![Pasted image 20250104113412](https://github.com/user-attachments/assets/8eb160d2-92d2-4e89-8f64-7a18191ef92f)

## Decoding the URL:

This is the URL that was gathered from the tcpdump command above. To decode it, I used CyberChef:

hxxp[://]103[.]232[.]55[.]148/service/[.]audiodg[.]exe

![Pasted image 20250104113008](https://github.com/user-attachments/assets/f9bdb2cc-ea47-411e-b809-fe0e4e1dd097)

I also used OSINT tools to find more information about this IP (103.323.55.148). This IP appears to be located in Vietnam:

![Pasted image 20250104110229](https://github.com/user-attachments/assets/033a2157-50a9-4adf-bc61-c4fada8f4d31)

Using Cisco Talos, the reputatiion for this IP is showing as poor:

![Pasted image 20250104110513](https://github.com/user-attachments/assets/9e0bd3b5-bb66-4399-bf21-a0ef34370eba)

I also used VirusTotal to get more information on the IP, and it was flagged by various vendors as malicious:

![Pasted image 20250104110629](https://github.com/user-attachments/assets/9039eb75-d5d2-494c-ab8a-83ab6e17124c)

Next, after researching the IP reputatation, I also checked the URL mentioned above in VirusTotal. This URL was also flagged as malicious by various vendors:

![Pasted image 20250104113844](https://github.com/user-attachments/assets/b206ddc2-c1e1-442e-a938-7708da38ccac)

In conclusion, based on the research above, the reputation of both the IP and the URL are being flagged by various vendors as malicious. Additioanlly, the IP is not affiliated to Microsoft.

## Extracting the EXE 

In order to better analyze the executable that was downloaded, I used a custom python script (PE Extract), to extract the PE from the trace file. Please note, this can also be performed using Wireshark. 

![Pasted image 20250104122417](https://github.com/user-attachments/assets/8cd8447e-b0ea-4a7c-b21d-523be3b56ee8)

Below is the hash for the file:

SHA256: f485d1a65ccf9f857baa49725d337c15e8aa34515b85c8ef59a72afad7b85249

![Pasted image 20250104121458](https://github.com/user-attachments/assets/15adebcc-90a3-4ad7-a63e-3910be920253)

For a dynamic analysis on the executable, I used Hybrid Analysis. Below is an overview of the behavior found in the file. As seen in the right-hand side, this was also categorized as malicious:

![Pasted image 20250104121413](https://github.com/user-attachments/assets/8cbc384e-6dc0-4202-9f0d-3391fad4e256)

## Defensive Actions

+ Infected host was isolated, forensic analysis was performed and the system was reimaged
+ Confirmed that there were no other affected hosts in the network using EDR
+ IP was blocked in the firewall
+ IDS/IPS rules were updated

